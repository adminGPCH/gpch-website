@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject GpchFrontend.Services.ThemeService Theme
@using GpchFrontend.Services
@using GpchFrontend.Components

<div class="page">
    @if (IsLoading)
    {
        <div class="gpch-transicion-wrapper">
            <FlorSVG Size="120" />
        </div>
    }
    else
    {
        <main>
            <div class="gpch-layout"
                 style="background-image: @Theme.FondoActual;
                   background-size: cover;
                   background-position: center;
                   background-repeat: no-repeat;
                   background-color: @FondoTema;">
                <AppBar />
                <div class="gpch-body">
                    @Body
                </div>
                <Footer />
            </div>
        </main>
    }
</div>

@code {
    private int ThemeFontSizeBase = ThemePalette.GetFontSizeBase("rojo");
    private int ThemeSpacingBase = ThemePalette.GetSpacingBase("rojo");
    private bool IsLoading = false;

    private string FondoTema = ThemePalette.GetColor("rojo");

    protected override void OnInitialized()
    {
        Theme.OnThemeChanged += ActualizarEstilos;

        Navigation.LocationChanged += (_, __) =>
        {
            IsLoading = true;
            StateHasChanged();

            _ = Task.Run(async () =>
            {
                await Task.Delay(600); // duración de la transición
                IsLoading = false;
                await InvokeAsync(StateHasChanged);
            });
        };

        ActualizarEstilos();
    }

    private void ActualizarEstilos()
    {
        var tema = Theme.TemaActual;
        ThemeFontSizeBase = ThemePalette.GetFontSizeBase(tema);
        ThemeSpacingBase = ThemePalette.GetSpacingBase(tema);
        FondoTema = ThemePalette.GetColor(tema);
        StateHasChanged();
    }
}
